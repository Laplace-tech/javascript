<!DOCTYPE html>
<html>

<head>
    <title>function-rock-scissors-paper</title>
</head>

<body>
    <p>Rock Paper Scissors</p>
    <button onclick="playGame('rock')">Rock</button>
    <button onclick="playGame('paper')">Paper</button>
    <button onclick="playGame('scissors')">Scissors</button>
    <button onclick="resetRecord()">Reset Record</button>
    <script>
        const record = {
            wins: 0,
            losses: 0,
            ties: 0
        };

        const keyMap = {
            win: 'wins',
            lose: 'losses',
            tie: 'ties'
        };

        console.log(record);
        console.log(keyMap);
        loadPreviousRecord();

        function loadPreviousRecord() {
            const storedRecord = localStorage.getItem('record');
            console.log(`loadPreviousRecord(): ${storedRecord}`);
            if(storedRecord) {
                const parsedRecord = JSON.parse(storedRecord); // JSON -> JavaScript Object
                for(const key in parsedRecord) {
                    record[key] = parsedRecord[key] || 0;
                }
            }
        }

        function saveRecord() {
            // for(const key in record) {
            //     localStorage.setItem(key, record[key]);
            // }
            const jsonRecord = JSON.stringify(record);
            console.log(`saveRecord(): localStorage.setItem('record', ${jsonRecord})`);
            localStorage.setItem('record', jsonRecord); // JavaScript Object -> JSON
        }

        function playGame(playerMove) {
            const computerMove = getComputerMove();
            const gameResult = fightEachOther(playerMove, computerMove);
             
            updateRecord(gameResult);
            saveRecord();
            alert(`You picked ${playerMove}. computer picked ${computerMove}. You ${gameResult}\n` +
                  `Wins: ${record.wins}, Losses: ${record.losses}, Ties: ${record.ties}`);
        }

        function getComputerMove() {
            const random = Math.random();
            if(random < (1 / 3)) return 'rock';
            else if(random < (2 / 3)) return 'paper';
            else return 'scissors';
        }

        function fightEachOther(playerMove, computerMove) {
            if (playerMove === computerMove) return 'tie';
            else if (
                (playerMove === 'rock' && computerMove === 'scissors') ||
                (playerMove === 'paper' && computerMove === 'rock') ||
                (playerMove === 'scissors' && computerMove === 'paper')
            ) return 'win';
            else {
                return 'lose';
            }
        }

        function updateRecord(gameResult) {
            const key = keyMap[gameResult];
            record[key] += 1;
            console.log(`updateRecord(): ${JSON.stringify(record)}`);
        }

        function resetRecord() {
            for(const key in record) {
                record[key] = 0;
            }
            console.log(`resetRecord(): ${JSON.stringify(record)}`);
            saveRecord();
            alert('Record Reset!\n' 
            + `Wins: ${record['wins']},` 
            + `Losses: ${record['losses']},` 
            + `Ties: ${record['ties']}`);
        }
    </script>
</body>


</html>